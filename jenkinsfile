pipeline {
    agent any
    tools{
        maven 'Maven-frank-1'
    }
    
    stages{
        

        stage('Build'){
            steps {
                sh 'mvn clean package'
                sh 'docker version'
                sh 'cd /var/jenkins_home/workspace/pipelinejob-test'
                sh 'docker images'
                sh 'docker rmi  -f 88dd01dc9909'
                sh 'docker rmi  -f 6da01a7a25e1'
                sh 'docker rmi  -f 3f8e8fb6dd4f'
                sh 'docker rmi  -f 310413c0e212'
                sh 'docker rmi  -f b270186b764e'
                sh 'docker rmi  -f 0839bbf9ba18'
                sh 'docker rmi  -f b251651a8a79'
                sh 'docker rmi  -f 5a7fab2c0f3c'
            }

            post {
                success {
                    echo '开始存档....'
                }
            }
        }

        stage('sonar'){

            environment {
                scannerHome = tool 'franktest'
            }

            steps {
                echo "start SonarQubeEnv testing"

                    withSonarQubeEnv('franktest') {
                    sh '${scannerHome}/bin/sonar-scanner -Dproject.settings=sonar-scanner.properties'
                }

                    timeout(time: 1, unit: 'MINUTES') {
                    waitForQualityGate abortPipeline: true
              }

                build job:"webhook-trigger"


            }
        }
    }
}


              