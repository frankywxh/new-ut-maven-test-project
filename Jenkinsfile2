pipeline {
    agent any
    tools{
        maven 'Maven-frank-1'
    }
    
    stages{
        

        stage('Deploy'){
            steps {
                sh 'docker rm -f websockerproject'
                sh 'docker pull registry.cn-hangzhou.aliyuncs.com/frankywxh/jenkins:v1'
                sh 'docker run --name websockerproject -p 8083:8080 -d registry.cn-hangzhou.aliyuncs.com/frankywxh/jenkins:v1'
            
            }

            post {
                success {
                    echo '正在构建'
                }
            }
        }

        stage('Jmeter') { 
            steps {
                sh "mkdir -p /opt/workspace/Jmeter/output"  
                sh "jmeter.sh -n -t src/main/Jmeter/franktest.jmx  -l /opt/workspace/Jmeter/demo.jtl -j /opt/workspace/Jmeter/demo.log -e -o /opt/workspace/Jmeter/output"
                step([$class: 'ArtifactArchiver', artifacts: 'jmeter/*,jmeter/output/*'])   
                perfReport "jmeter/frank.jtl"
            }
        }
    }
}


              